<!doctype html>
<html>
	<head>
		<title>JS1k, 1k demo submission [ID]</title>
		<meta charset="utf-8" />
	</head>
	<body>
		<canvas id="c"></canvas>
		<script>
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
		</script>
		<script>
// start of submission //

b.style.margin = 0;
c.style.display = 'block';
w = c.width = innerWidth;
h = c.height = innerHeight;

// create initial black background
a.fillStyle = 'black';
a.fillRect(0, 0, w, h);

// draw object
rg = a.createRadialGradient(w/2, h/2, 30, w/2, h/2, 100);
rg.addColorStop(0, 'rgb(40,40,40)');
rg.addColorStop(1, 'black');
a.fillStyle = rg;
//a.fillStyle = 'red';
a.fillRect(0, 0, w, h);

// create random pattern
randW = 150;
randH = randW;

console.log('generating random data');
randData = new Uint32Array(randW*randH);
for (i=0; i<=randW*randH-1; i++) {
    v = Math.floor(Math.random()*0xFFFFFFFF)|0xFF000000;
    randData[i] = v;
}

// read height map into typed array
scr = a.getImageData(0, 0, w, h);
scrData32 = new Uint32Array(scr.data.buffer);
scrData8 = new Uint8Array(scr.data.buffer);

console.log('start absird');
// run absird algorithm
for (y = 0; y <= h-1; y++) {
    for (x = w-1; x > w-randW; x--) {

        scrpos = y*w+x;
        scrv = scrData32[scrpos]&0xFF;

        randxpos = (x - scrv)%randW;
        randypos = y%randH;
        randpos = (randypos*randW+randxpos)
        randv = randData[randpos];

        scrData32[scrpos]=randv;
    }

    for (x=w-randW; x>=0; x--) {
        scrpos = y*w+x;
        scrv = scrData32[scrpos]&0xFF;

        scrrpos = (y*w+x-2+randW-scrv);

        scrData32[scrpos] = scrData32[scrrpos];
    }

}
console.log('end absird');
// run absird algorithm

// write rendered frame back to canvas
a.putImageData(scr, 0, 0);


// end of submission //
		</script>
	</body>
</html>
